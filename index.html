<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Futbol Oyunu</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0a3d0a;
      color: white;
      text-align: center;
      user-select: none;
      -webkit-user-select: none;
      overflow: hidden;
    }

    #menu {
      padding: 50px;
      text-align: center;
      color: white;
    }

    .team {
      padding: 10px 20px;
      margin: 10px auto;
      background: #222;
      color: white;
      width: 250px;
      border: 2px solid white;
      cursor: pointer;
      border-radius: 8px;
      transition: 0.2s;
      user-select: none;
    }

    .team:hover {
      background: #444;
    }

    canvas {
      display: none;
      margin: auto;
      background: #006400;
      border: 2px solid white;
      touch-action: none;
    }

    /* Butonlar üstte ve büyük */
    #mobileControls {
      display: none;
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 400px;
      user-select: none;
      z-index: 100;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    #joystick {
      width: 150px;
      height: 150px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      position: relative;
      touch-action: none;
    }

    #stick {
      width: 70px;
      height: 70px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      position: absolute;
      top: 40px;
      left: 40px;
      touch-action: none;
      transition: transform 0.1s;
    }

    #buttons {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .btn {
      width: 70px;
      height: 70px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      line-height: 70px;
      font-size: 28px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
      display: inline-block;
      transition: background 0.2s;
      text-align: center;
      user-select: none;
    }
    .btn:active {
      background: rgba(255, 255, 255, 0.5);
    }

    #scoreBoard {
      font-size: 24px;
      margin-top: 10px;
      position: fixed;
      top: 180px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.3);
      padding: 10px 20px;
      border-radius: 10px;
      user-select: none;
      z-index: 100;
    }
  </style>
</head>
<body>

<div id="menu">
  <h1>Takımını Seç</h1>
</div>

<canvas id="gameCanvas" width="1000" height="600"></canvas>

<!-- Mobil kontrol butonları -->
<div id="mobileControls">
  <div id="joystick">
    <div id="stick"></div>
  </div>
  <div id="buttons">
    <div class="btn" id="btn-pass" title="Pas">P</div>
    <div class="btn" id="btn-shoot" title="Şut">S</div>
    <div class="btn" id="btn-switch" title="Oyuncu Değiştir">D</div>
  </div>
</div>

<div id="scoreBoard"></div>

<script>
// Takımlar
const teams = [
  { name: "Galatasaray", color: "#ff0000", secondColor: "#ffcc00" },
  { name: "Fenerbahçe", color: "#000080", secondColor: "#ffff00" },
  { name: "Beşiktaş", color: "#000000", secondColor: "#ffffff" },
  { name: "Trabzonspor", color: "#800000", secondColor: "#87cefa" },
  { name: "Başakşehir", color: "#1e3f66", secondColor: "#ff6600" },
  { name: "Konyaspor", color: "#006400", secondColor: "#ffffff" },
  { name: "Bursaspor", color: "#228B22", secondColor: "#ffffff" },
  { name: "Adana Demirspor", color: "#4169e1", secondColor: "#ffffff" }
];

const menuDiv = document.getElementById("menu");
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const mobileControls = document.getElementById("mobileControls");
const stick = document.getElementById("stick");
const btnPass = document.getElementById("btn-pass");
const btnShoot = document.getElementById("btn-shoot");
const btnSwitch = document.getElementById("btn-switch");
const scoreBoard = document.getElementById("scoreBoard");

let playerTeam = null;
let opponentTeam = null;
let players = [];
let ball = { x: 500, y: 300, radius: 7, color: "white", dx: 0, dy: 0 };
let score = [0, 0]; // [player, opponent]
let keys = {};
let controlledPlayerIndex = 0; // Hangi oyuncu kontrol ediliyor?

// Menü oluştur
teams.forEach((team, index) => {
  const div = document.createElement("div");
  div.className = "team";
  div.textContent = `${index + 1}. ${team.name}`;
  div.onclick = () => startGame(team);
  menuDiv.appendChild(div);
});

function startGame(selectedTeam) {
  playerTeam = selectedTeam;

  // Rakip rastgele ama aynı takım olmasın
  do {
    opponentTeam = teams[Math.floor(Math.random() * teams.length)];
  } while (opponentTeam.name === playerTeam.name);

  menuDiv.style.display = "none";
  canvas.style.display = "block";
  mobileControls.style.display = "flex";

  initMatch();
  updateScore();
  gameLoop();
}

// Sahadaki 11 oyuncuyu oluştur
function generatePlayers(team, isLeft) {
  const direction = isLeft ? 1 : -1;
  const baseX = isLeft ? 100 : 900;
  const teamPlayers = [];

  // Kaleci
  teamPlayers.push({
    x: baseX - 50 * direction,
    y: 300,
    radius: 12,
    color: team.secondColor,
    teamName: team.name,
    isBot: !isLeft // Rakip takım bot
  });

  // Defans
  for (let i = 0; i < 4; i++) {
    teamPlayers.push({
      x: baseX,
      y: 100 + i * 100,
      radius: 10,
      color: team.color,
      teamName: team.name,
      isBot: !isLeft
    });
  }

  // Orta Saha
  for (let i = 0; i < 4; i++) {
    teamPlayers.push({
      x: baseX + 80 * direction,
      y: 75 + i * 125,
      radius: 10,
      color: team.color,
      teamName: team.name,
      isBot: !isLeft
    });
  }

  // Forvet
  for (let i = 0; i < 2; i++) {
    teamPlayers.push({
      x: baseX + 160 * direction,
      y: 200 + i * 200,
      radius: 10,
      color: team.color,
      teamName: team.name,
      isBot: !isLeft
    });
  }

  return teamPlayers;
}

function initMatch() {
  players = [];
  players.push(...generatePlayers(playerTeam, true));
  players.push(...generatePlayers(opponentTeam, false));

  // Başlangıç top pozisyonu
  ball.x = canvas.width / 2;
  ball.y = canvas.height / 2;
  ball.dx = 0;
  ball.dy = 0;

  controlledPlayerIndex = findClosestPlayerToBall();

  score = [0, 0];
  updateScore();
}

// Saha çizimi
function drawField() {
  ctx.fillStyle = "green";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Orta çizgi
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(canvas.width / 2, 0);
  ctx.lineTo(canvas.width / 2, canvas.height);
  ctx.stroke();

  // Orta daire
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(canvas.width / 2, canvas.height / 2, 60, 0, Math.PI * 2);
  ctx.stroke();

  // Kaleler
  ctx.fillStyle = "white";
  ctx.fillRect(0, canvas.height / 2 - 50, 10, 100);
  ctx.fillRect(canvas.width - 10, canvas.height / 2 - 50, 10, 100);
}

// Oyuncular ve topu çiz
function drawPlayers() {
  players.forEach((p, i) => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    ctx.fillStyle = p.color;
    ctx.fill();
    ctx.strokeStyle = i === controlledPlayerIndex ? "yellow" : "black";
    ctx.lineWidth = i === controlledPlayerIndex ? 3 : 1;
    ctx.stroke();
  });
}

function drawBall() {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
  ctx.fillStyle = ball.color;
  ctx.fill();
}

function drawTeamLabels() {
  ctx.font = "20px Arial";
  ctx.fillStyle = playerTeam.color;
  ctx.fillText(`${playerTeam.name}`, 50, 30);
  ctx.fillStyle = opponentTeam.color;
  ctx.fillText(`${opponentTeam.name}`, canvas.width - 200, 30);
}

function updateScore() {
  scoreBoard.textContent = `${playerTeam.name}: ${score[0]} - ${opponentTeam.name}: ${score[1]}`;
}

// Oyuncu topa en yakın olanı bul
function findClosestPlayerToBall(teamName = playerTeam.name) {
  let closestIndex = 0;
  let closestDist = Infinity;
  players.forEach((p, i) => {
    if (p.teamName === teamName) {
      const dx = p.x - ball.x;
      const dy = p.y - ball.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < closestDist) {
        closestDist = dist;
        closestIndex = i;
      }
    }
  });
  return closestIndex;
}

// Oyuncu hareketi
function movePlayer(dx, dy) {
  let p = players[controlledPlayerIndex];
  let speed = 3;

  let newX = p.x + dx * speed;
  let newY = p.y + dy * speed;

  // Saha sınırları
  if (newX - p.radius < 0) newX = p.radius;
  if (newX + p.radius > canvas.width) newX = canvas.width - p.radius;
  if (newY - p.radius < 0) newY = p.radius;
  if (newY + p.radius > canvas.height) newY = canvas.height - p.radius;

  // Yeni pozisyona ata
  p.x = newX;
  p.y = newY;

  // Eğer oyuncu topa yakınsa topu hareket ettir
  const dist = Math.sqrt((ball.x - p.x) ** 2 + (ball.y - p.y) ** 2);
  if (dist < p.radius + ball.radius + 5) {
    ball.x += dx * speed;
    ball.y += dy * speed;
  }
}

// Top hareketi ve sürtünme
function updateBall() {
  ball.x += ball.dx;
  ball.y += ball.dy;

  // Sürtünme
  ball.dx *= 0.95;
  ball.dy *= 0.95;

  // Saha sınırları top için
  if (ball.x - ball.radius < 0) {
    // Gol sol kale?
    if (ball.y > canvas.height / 2 - 50 && ball.y < canvas.height / 2 + 50) {
      score[1]++;
      resetAfterGoal();
      return;
    } else {
      ball.x = ball.radius;
      ball.dx *= -1;
    }
  }

  if (ball.x + ball.radius > canvas.width) {
    // Gol sağ kale?
    if (ball.y > canvas.height / 2 - 50 && ball.y < canvas.height / 2 + 50) {
      score[0]++;
      resetAfterGoal();
      return;
    } else {
      ball.x = canvas.width - ball.radius;
      ball.dx *= -1;
    }
  }

  if (ball.y - ball.radius < 0 || ball.y + ball.radius > canvas.height) {
    ball.dy *= -1;
    if (ball.y - ball.radius < 0) ball.y = ball.radius;
    if (ball.y + ball.radius > canvas.height) ball.y = canvas.height - ball.radius;
  }
}

// Gol sonrası sıfırlama
function resetAfterGoal() {
  alert("Gol! Skor: " + playerTeam.name + " " + score[0] + " - " + opponentTeam.name + " " + score[1]);
  ball.x = canvas.width / 2;
  ball.y = canvas.height / 2;
  ball.dx = 0;
  ball.dy = 0;

  // Topa en yakın oyuncular kontrol edilir
  controlledPlayerIndex = findClosestPlayerToBall();
  updateScore();
}

// Kontrolü başka oyuncuya geçirme
function switchPlayer() {
  let start = controlledPlayerIndex;
  let found = false;
  let i = (controlledPlayerIndex + 1) % players.length;
  while (i !== start) {
    if (players[i].teamName === playerTeam.name) {
      controlledPlayerIndex = i;
      found = true;
      break;
    }
    i = (i + 1) % players.length;
  }
  if (!found) controlledPlayerIndex = start; // Değişiklik yok
}

// Pas verme (topu ileri doğru atar)
function passBall() {
  let p = players[controlledPlayerIndex];
  let dirX = 1;
  if (p.x > canvas.width / 2) dirX = -1;

  ball.dx = dirX * 8;
  ball.dy = 0;
  ball.x = p.x + dirX * (p.radius + ball.radius + 1);
  ball.y = p.y;
}

// Şut çekme (topu güçlü ileri atar)
function shootBall() {
  let p = players[controlledPlayerIndex];
  let dirX = 1;
  if (p.x > canvas.width / 2) dirX = -1;

  ball.dx = dirX * 15;
  ball.dy = 0;
  ball.x = p.x + dirX * (p.radius + ball.radius + 1);
  ball.y = p.y;
}

// Bot takım basit yapay zekası
function botBehavior() {
  players.forEach((p, i) => {
    if (!p.isBot) return; // Sadece botlar

    const distToBall = Math.hypot(ball.x - p.x, ball.y - p.y);

    // Basit: topa yakınsa topa doğru hareket et
    if (distToBall > 20) {
      const dx = (ball.x - p.x) / distToBall;
      const dy = (ball.y - p.y) / distToBall;
      p.x += dx * 2;
      p.y += dy * 2;
    } else {
      // Topa yakınsa rastgele hareket veya topu uzaklaştır
      if (Math.random() < 0.05) {
        // Topu ileri doğru uzaklaştır (sağ kaleye doğru)
        ball.dx = 10;
        ball.dy = 0;
      }
    }

    // Saha sınırları kontrolü
    if (p.x - p.radius < canvas.width / 2) p.x = canvas.width / 2 + p.radius; // Bot takım sahayı geçmesin
    if (p.x + p.radius > canvas.width) p.x = canvas.width - p.radius;
    if (p.y - p.radius < 0) p.y = p.radius;
    if (p.y + p.radius > canvas.height) p.y = canvas.height - p.radius;
  });
}

// Oyun döngüsü
function gameLoop() {
  // Klavye hareketi
  let dx = 0;
  let dy = 0;
  if (keys["ArrowUp"] || keys["w"] || keys["W"]) dy -= 1;
  if (keys["ArrowDown"] || keys["s"] || keys["S"]) dy += 1;
  if (keys["ArrowLeft"] || keys["a"] || keys["A"]) dx -= 1;
  if (keys["ArrowRight"] || keys["d"] || keys["D"]) dx += 1;

  // Normalize hareket
  if (dx !== 0 || dy !== 0) {
    let len = Math.sqrt(dx * dx + dy * dy);
    dx /= len;
    dy /= len;
    movePlayer(dx, dy);
  }

  botBehavior();
  updateBall();
  drawScene();

  requestAnimationFrame(gameLoop);
}

function drawScene() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawField();
  drawPlayers();
  drawBall();
  drawTeamLabels();
  updateScore();
}

// Klavye olayları
window.addEventListener("keydown", e => {
  keys[e.key] = true;

  // D tuşu ile oyuncu değiştir
  if (e.key === "d" || e.key === "D") {
    switchPlayer();
  }

  // P tuşu pas
  if (e.key === "p" || e.key === "P") {
    passBall();
  }

  // S tuşu şut
  if (e.key === "s" || e.key === "S") {
    shootBall();
  }
});

window.addEventListener("keyup", e => {
  keys[e.key] = false;
});

// Mobil joystick kontrolü
let joystickActive = false;
let startX = 0, startY = 0;
let moveX = 0, moveY = 0;

stick.addEventListener("touchstart", e => {
  joystickActive = true;
  const touch = e.touches[0];
  startX = touch.clientX;
  startY = touch.clientY;
});

stick.addEventListener("touchmove", e => {
  if (!joystickActive) return;
  const touch = e.touches[0];
  moveX = touch.clientX - startX;
  moveY = touch.clientY - startY;

  // Maks 50px hareket ettir
  const maxDist = 50;
  let dist = Math.sqrt(moveX * moveX + moveY * moveY);
  if (dist > maxDist) {
    moveX = (moveX / dist) * maxDist;
    moveY = (moveY / dist) * maxDist;
  }

  stick.style.transform = `translate(${moveX}px, ${moveY}px)`;
});

stick.addEventListener("touchend", e => {
  joystickActive = false;
  moveX = 0;
  moveY = 0;
  stick.style.transform = `translate(0, 0)`;
});

// Mobil joystick hareketini oyun döngüsüne aktar
function getJoystickDirection() {
  if (!joystickActive) return { dx: 0, dy: 0 };

  let dx = moveX / 50;
  let dy = moveY / 50;
  if (dx * dx + dy * dy > 1) {
    let len = Math.sqrt(dx * dx + dy * dy);
    dx /= len;
    dy /= len;
  }
  return { dx, dy };
}

// Mobil butonlar pas, şut, oyuncu değiştir
btnPass.addEventListener("touchstart", e => { passBall(); e.preventDefault(); });
btnShoot.addEventListener("touchstart", e => { shootBall(); e.preventDefault(); });
btnSwitch.addEventListener("touchstart", e => { switchPlayer(); e.preventDefault(); });

// Oyun döngüsü güncelleme (joystick)
function gameLoop() {
  // Klavye hareketi
  let dx = 0;
  let dy = 0;
  if (keys["ArrowUp"] || keys["w"] || keys["W"]) dy -= 1;
  if (keys["ArrowDown"] || keys["s"] || keys["S"]) dy += 1;
  if (keys["ArrowLeft"] || keys["a"] || keys["A"]) dx -= 1;
  if (keys["ArrowRight"] || keys["d"] || keys["D"]) dx += 1;

  // Mobil joystick hareketi
  const joystickDir = getJoystickDirection();
  dx += joystickDir.dx;
  dy += joystickDir.dy;

  // Normalize hareket
  if (dx !== 0 || dy !== 0) {
    let len = Math.sqrt(dx * dx + dy * dy);
    dx /= len;
    dy /= len;
    movePlayer(dx, dy);
  }

  botBehavior();
  updateBall();
  drawScene();

  requestAnimationFrame(gameLoop);
}
</script>

</body>
  </html>
