<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<title>Futbol Oyunu</title>
<style>
  * { box-sizing: border-box; }
  body { margin: 0; font-family: Arial; background: #0a3d0a; color: white; overflow: hidden; }
  #menu { padding: 50px; text-align: center; }
  .team { padding:10px; margin:10px auto; background:#222; color:white; width:250px; cursor:pointer; border:2px solid white; }
  .team:hover { background:#444; }
  canvas { display:none; background:#006400; border:2px solid white; margin:auto; touch-action:none; }
  #mobileControls { display:none; position:fixed; bottom:15px; left:50%; transform:translateX(-50%); width:350px; display:flex; justify-content:center; gap:15px; z-index:100; }
  .btn { width:70px; height:70px; background:rgba(255,255,255,0.2); border-radius:50%; font-size:28px; text-align:center; line-height:70px; color:white; cursor:pointer; }
  .btn:active { background:rgba(255,255,255,0.5); }
  #joystick { width:120px; height:120px; background:rgba(255,255,255,0.1); border-radius:50%; position:relative; }
  #stick { width:50px; height:50px; background:rgba(255,255,255,0.3); border-radius:50%; position:absolute; top:35px; left:35px; }
  #scoreBoard, #timeBoard { position:fixed; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.3); padding:6px 12px; border-radius:8px; z-index:100; }
  #scoreBoard { top:60px; font-size:20px; }
  #timeBoard { top:90px; font-size:20px; }
</style>
</head>
<body>

<div id="menu"><h1>Takƒ±mƒ±nƒ± Se√ß</h1></div>
<canvas id="gameCanvas" width="1000" height="600"></canvas>

<div id="mobileControls">
  <div id="joystick"><div id="stick"></div></div>
  <div class="btn" id="btn-pass">P</div>
  <div class="btn" id="btn-shoot">S</div>
  <div class="btn" id="btn-switch">D</div>
</div>
<div id="scoreBoard"></div>
<div id="timeBoard"></div>

<script>
// Ayarlar
const MATCH_DURATION=90*60, OVT_DURATION=30*60, FRAME_RATE=60;
const teams=[{name:"GS",color:"#ff0000",sc:"#ffcc00"},{name:"FB",color:"#000080",sc:"#ffff00"}];
const menu=document.getElementById("menu"),c=document.getElementById("gameCanvas"),ctx=c.getContext("2d");
const mob=document.getElementById("mobileControls"), stick=document.getElementById("stick");
const btnP=document.getElementById("btn-pass"), btnS=document.getElementById("btn-shoot"), btnD=document.getElementById("btn-switch");
const scoreB=document.getElementById("scoreBoard"), timeB=document.getElementById("timeBoard");

let playerTeam,oppTeam,players=[],ball={x:500,y:300,dx:0,dy:0,r:7},score=[0,0],keys={},ctrl=0,joyX=0,joyY=0,t=0,ovt=false;

// Men√º
teams.forEach((t,i)=>{
  const d=document.createElement("div");
  d.className="team"; d.textContent=`${i+1}. ${t.name}`;
  d.onclick=()=>start(t);
  menu.appendChild(d);
});

function start(pt){
  playerTeam=pt; oppTeam=teams.find(t=>t.name!==pt.name);
  menu.style.display="none"; c.style.display="block"; mob.style.display="flex";
  init(); requestAnimationFrame(loop);
}

function init(){
  players=[]; score=[0,0]; t=0; ovt=false;
  createTeam(playerTeam,true); createTeam(oppTeam,false);
  ctrl=closest(); ball.x=500; ball.y=300; ball.dx=0; ball.dy=0;
}

function createTeam(t,l){
  const dir=l?1:-1, baseX=l?100:900, roleNames=["GK","DF","MF","FW"], counts=[1,4,4,2];
  let idx=0;
  for(let r=0;r<4;r++)for(let j=0;j<counts[r];j++){
    const y=100+ (600-200)*(j/(counts[r]-1||1));
    const x=baseX+(r*80-50)*dir*(r>0?1:1);
    players.push({x,y,r:(r==0?12:10),color:(r==0?t.sc:t.color),team:t.name,isBot:!l,name:`${t.name}${r}${j}`,st:100,card:null,role:roleNames[r]});
  }
}

function closest(){
  let mi=0,md=1e9;
  players.forEach((p,i)=>{
    if(p.team===playerTeam.name){
      const d=(p.x-ball.x)**2+(p.y-ball.y)**2;
      if(d<md){md=d;mi=i;}
    }
  });
  return mi;
}

function draw(){
  ctx.fillStyle="green"; ctx.fillRect(0,0,1000,600);
  ctx.strokeStyle="white";ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(500,0);ctx.lineTo(500,600);ctx.stroke();
  ctx.beginPath();ctx.arc(500,300,60,0,2*Math.PI);ctx.stroke();
  ctx.fillStyle="white";ctx.fillRect(0,250,10,100);ctx.fillRect(990,250,10,100);
  players.forEach((p,i)=>{
    ctx.globalAlpha=p.st<30?0.4:1;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,2*Math.PI);ctx.fillStyle=p.color;ctx.fill();
    ctx.strokeStyle=(i===ctrl)?"yellow":"black";
    ctx.lineWidth=(i===ctrl)?3:1;ctx.stroke();
    ctx.globalAlpha=1;
    ctx.fillStyle="white";ctx.font="12px Arial";ctx.fillText(p.name,p.x-10,p.y-20);
  });
  ctx.beginPath();ctx.arc(ball.x,ball.y,ball.r,0,2*Math.PI);ctx.fillStyle="white";ctx.fill();
}

function updateHUD(){
  scoreB.textContent=`${playerTeam.name}:${score[0]} - ${oppTeam.name}:${score[1]}`;
  let sec=Math.floor(t); const max=ovt?MATCH_DURATION+OVT_DURATION:MATCH_DURATION;
  if(sec>max) sec=max;
  const m=Math.floor(sec/60), s=sec%60; timeB.textContent=`${m}:${s.toString().padStart(2,"0")}${ovt?" üîÅ":""}`;
}

function physics(){
  ball.x+=ball.dx; ball.y+=ball.dy;
  ball.dx*=0.98;ball.dy*=0.98;
  if(ball.x<10&&ball.y>250&&ball.y<350){score[1]++;reset();} 
  else if(ball.x>990&&ball.y>250&&ball.y<350){score[0]++;reset();}
  if(ball.x<0||ball.x>1000) ball.dx*=-1;
  if(ball.y<0||ball.y>600) ball.dy*=-1;
  if(ball.x<0||ball.x>1000||ball.y<0||ball.y>600){
    ball.x=500;ball.y=300;ball.dx=0;ball.dy=0;alert("Ta√ß / Korner");
  }
}

function reset(){
  alert("Gol!"); init();
}

function move(){
  const p=players[ctrl]; let dx=0,dy=0;
  if(keys.w||keys.ArrowUp)dy--;
  if(keys.s||keys.ArrowDown)dy++;
  if(keys.a||keys.ArrowLeft)dx--;
  if(keys.d||keys.ArrowRight)dx++;
  dx+=joyX/40;dy+=joyY/40;
  if(dx||dy){
    const len=Math.hypot(dx,dy);
    p.x=Math.max(p.r,Math.min(1000-p.r,p.x+dx/len*2));
    p.y=Math.max(p.r,Math.min(600-p.r,p.y+dy/len*2));
    p.st=Math.max(0,p.st-0.02);
    if(Math.hypot(ball.x-p.x,ball.y-p.y)<p.r+ball.r+2){
      ball.x+=dx/len*5;ball.y+=dy/len*5;ball.dx=dx/len*5;ball.dy=dy/len*5;
    }
  }
}

function passShot(pw){
  const p=players[ctrl], dir=(ball.x<p.x)?-1:1;
  ball.dx=dir*pw*(p.st/100+1);ball.dy=0;
}

function switchPlay(){ctrl=closest();}

function botAI(){
  players.forEach((p)=>{
    if(!p.isBot) return;
    if(p.role==="GK"){
      const dy=ball.y-p.y;
      if(Math.abs(dy)>5) p.y+=Math.sign(dy)*2;
    } else {
      const dx=ball.x-p.x, dy=ball.y-p.y, d=Math.hypot(dx,dy);
      if(d>20){p.x+=dx/d*1.5;p.y+=dy/d*1.5;}
      else if(Math.random()<0.01){ball.dx=(p.x<500?5:-5);ball.dy=0;}
    }
  });
}

function frame(){
  t+=1/FRAME_RATE;
  if(!ovt && t>=MATCH_DURATION && score[0]===score[1]){ovt=true;}
  if(t>=MATCH_DURATION+(ovt?OVT_DURATION:0)){alert("Ma√ß bitti!");location.reload();}
  move();physics();botAI();draw();updateHUD();
}

window.addEventListener("keydown",e=>{keys[e.key]=true;if(e.key==="p")passShot(8);if(e.key==="s")passShot(14);if(e.key==="d")switchPlay();});
window.addEventListener("keyup",e=>keys[e.key]=false);
stick.addEventListener("touchmove",e=>{
  const tch=e.touches[0], r=stick.getBoundingClientRect();
  joyX=tch.clientX-(r.left+r.width/2);
  joyY=tch.clientY-(r.top+r.height/2);
  const d=Math.hypot(joyX,joyY);if(d>40){joyX=joyX/d*40;joyY=joyY/d*40;}
  stick.style.transform=`translate(${joyX}px,${joyY}px)`;
});
stick.addEventListener("touchend",()=>{joyX=joyY=0;stick.style.transform="translate(0,0)";});
btnP.addEventListener("click",()=>passShot(8));
btnS.addEventListener("click",()=>passShot(14));
btnD.addEventListener("click",switchPlay);

function loop(){frame();requestAnimationFrame(loop);}
</script>
</body>
</html>
